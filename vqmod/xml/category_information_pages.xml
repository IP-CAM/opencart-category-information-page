<modification>
	<id>Category Infopages</id>
	<version>1.0</version>
	<vqmver>1.2.3</vqmver>
	<author>mithereal</author>
	<file name="admin\controller\catalog\category.php">
		<operation>
			<search position="before"><![CDATA[
                        if (isset($this->request->post['path'])) {
                        ]]></search>
                        
                        <add><![CDATA[
                        //start cat infopages
						$this->load->model('catalog/information');
                        $infopages = $this->model_catalog_information->getInformations();
                        $this->data['infopages'] = $infopages;
                        //end cat infopages
                        ]]></add>

		</operation>
	</file>
	
	<file name="admin\controller\catalog\category.php">
		<operation>
			<search position="before"><![CDATA[
                        // Set which layout to use with this category
                        ]]></search>
                        
                        <add><![CDATA[//start of con-cor mod
		if ($data['information_id']) {
			$this->db->query("INSERT INTO " . DB_PREFIX . "information_to_category SET category_id='" . (int)$category_id . "', information_id = '" . (int)$data['information_id'] . "'");
		}
//end of con-cor mod
                        ]]></add>

		</operation>
	</file>
	
	<file name="admin\controller\catalog\category.php">
		<operation>
			<search position="before"><![CDATA[
			<td><?php echo $entry_store; ?></td>
                        ]]></search>
                        
                        <add><![CDATA[//start of con-cor mod
		<tr>
              <td>Categorys Information Page</td>
              <td><select name="information_id">
                  <option value="NULL"><?php echo $text_none; ?></option>
                  <?php foreach ($infopages as $page) { ?>
                  <?php if ($information_id['information_id'] == $page['information_id']) { ?>
                  <option value="<?php echo $page['information_id']; ?>" selected="selected"><?php echo $page['title']; ?></option>
                  <?php } else { ?>
                  <option value="<?php echo $page['information_id']; ?>"><?php echo $page['title']; ?></option>
                  <?php } ?>
                  <?php } ?>
                </select></td>
            </tr>
//end of con-cor mod]]></add>

		</operation>
	</file>
	
	<file name="catalog\model\catalog\category.php">
		<operation>
			<search position="before" offset="2"><![CDATA[?>]]></search>
                        
                        <add><![CDATA[
                        //start of con-cor mod
public function getCategoryInformation($category_id) {
		$category_layout_data = array();
		
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "information_to_category WHERE category_id = '" . (int)$category_id . "'");
		
		return $query->row;
	}
//end of con-cor mod]]></add>

		</operation>
	</file>
	
	<file name="catalog\controller\product\category.php">
		<operation>
			<search position="after"><![CDATA[
			$this->load->model('tool/image'); 
                        ]]></search>
                        
                        <add><![CDATA[
                        //start of category information page mod
						$this->language->load('information/information');
		$this->load->model('catalog/information');
						//end of category information page mod
                        ]]></add>

		</operation>
	</file>
	
	<file name="catalog\controller\product\category.php">
		<operation>
			<search position="before"><![CDATA[
			$this->data['products'][] = array(
                        ]]></search>
                        
                        <add><![CDATA[
					//start of category information page mod

			$informations = $this->model_catalog_category->getCategoryInformation($category_id);
			$this->data['information_id'] = $informations['information_id'];
			$information_info = $this->model_catalog_information->getInformation($this->data['information_id']); 
			if($information_info)
			$this->data['information_info'] = html_entity_decode($information_info['description'], ENT_QUOTES, 'UTF-8');
	
			//end of category information page mod


                        ]]></add>

		</operation>
	</file>
	
	<file name="catalog\model\catalog\product.php">
		<operation>
			<search position="before" offset="2"><![CDATA[?>]]></search>
                        
                        <add><![CDATA[//start of category information page mod
		
public function getCategoryInformation($category_id) {
		$category_layout_data = array();
		
		$query = $this->db->query("SELECT * FROM " . DB_PREFIX . "information_to_category WHERE category_id = '" . (int)$category_id . "'");
		
		return $query->row;
	}
//end of category information page mod]]></add>

		</operation>
	</file>
	
</modification>
